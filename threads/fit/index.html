<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-10-20 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20151020" />
    <meta http-equiv="Content-Language" content="en" />
    <title>java-sandbox &#x2013; <a name="top"></a> Modeling and Fitting SED Data in Iris</title>
    <link rel="stylesheet" href="../../css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="../../css/site.css" />
    <link rel="stylesheet" href="../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../js/apache-maven-fluido-1.4.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
        
    
        
    <a href="https://github.com/olaurino/sandbox">
      <img style="position: absolute; top: 0; left: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../../" id="bannerLeft">
                                                                                                <img src="../../imgs/Iris_logo_padding.png"  alt="Chandra CXC"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-10-20
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
                      <a href="http://cxc.cfa.harvard.edu" class="externalLink" title="Chandra CXC">
        Chandra CXC</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Iris</li>
                              
      <li>
  
                          <a href="../../index.html" title="Homepage">
          <span class="none"></span>
        Homepage</a>
            </li>
                              <li class="nav-header">Introduction</li>
                              
      <li>
  
                          <a href="../../intro/index.html" title="About">
          <span class="none"></span>
        About</a>
            </li>
                
      <li>
  
                          <a href="../../intro/features.html" title="Features">
          <span class="none"></span>
        Features</a>
            </li>
                
      <li>
  
                          <a href="../../intro/future.html" title="Future">
          <span class="none"></span>
        Future</a>
            </li>
                              <li class="nav-header">Download Iris</li>
                              
      <li>
  
                          <a href="../../download/index.html" title="Download & Installation">
          <span class="none"></span>
        Download & Installation</a>
            </li>
                
      <li>
  
                          <a href="../../download/smoke_tests.html" title="Smoke Test">
          <span class="none"></span>
        Smoke Test</a>
            </li>
                
      <li>
  
                          <a href="../../bugs/smoke.html" title="Troubleshooting">
          <span class="none"></span>
        Troubleshooting</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../guide.html" title="How-To Guide">
          <span class="icon-chevron-down"></span>
        How-To Guide</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../../threads/entry/index.html" title="Loading SED Data into Iris">
          <span class="none"></span>
        Loading SED Data into Iris</a>
            </li>
                    
      <li>
  
                          <a href="../../threads/importer/index.html" title="Building and Managing SEDs">
          <span class="none"></span>
        Building and Managing SEDs</a>
            </li>
                    
      <li>
  
                          <a href="../../threads/plot/index.html" title="Visualizing SED Data">
          <span class="none"></span>
        Visualizing SED Data</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Modeling and Fiting SED Data</a>
          </li>
                    
      <li>
  
                          <a href="../../threads/save/index.html" title="Saving SED Data">
          <span class="none"></span>
        Saving SED Data</a>
            </li>
                    
      <li>
  
                          <a href="../../threads/science/index.html" title="Shifting, Interpolating, and Integrating SED Data">
          <span class="none"></span>
        Shifting, Interpolating, and Integrating SED Data</a>
            </li>
                    
      <li>
  
                          <a href="../../threads/science/sedstacker/index.html" title="Statistically Combining SEDs">
          <span class="none"></span>
        Statistically Combining SEDs</a>
            </li>
                    
      <li>
  
                          <a href="../../threads/sdk/index.html" title="Creating Iris Plugins: The Iris Software Development Kit">
          <span class="none"></span>
        Creating Iris Plugins: The Iris Software Development Kit</a>
            </li>
                    
      <li>
  
                          <a href="../../threads/plugin_manager/index.html" title="Installing Iris Plugins">
          <span class="none"></span>
        Installing Iris Plugins</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="../../bugs/index.html" title="Bugs & Caveats">
          <span class="none"></span>
        Bugs & Caveats</a>
            </li>
                
      <li>
  
                          <a href="../../faq/index.html" title="FAQs">
          <span class="none"></span>
        FAQs</a>
            </li>
                
      <li>
  
                          <a href="../../releasenotes/index.html" title="Release Notes">
          <span class="none"></span>
        Release Notes</a>
            </li>
                              <li class="nav-header">References</li>
                              
      <li>
  
                          <a href="../../references/models.html" title="Iris Models">
          <span class="none"></span>
        Iris Models</a>
            </li>
                
      <li>
  
                          <a href="../../references/importer_files.html" title="Supported File Formats">
          <span class="none"></span>
        Supported File Formats</a>
            </li>
                
      <li>
  
                          <a href="../../publications/index.html" title="Publications">
          <span class="none"></span>
        Publications</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                            
      <li>
  
                          <a href="../../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="http://olaurino.github.io/java-sandbox/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1><a name="top"></a> Modeling and Fitting SED Data in Iris</h1>
<hr />
<div class="section">
<h2><a name="Overview"></a><a name="overview"></a>Overview</h2>
<div class="section">
<div class="section">
<h4><a name="Synopsis:"></a>Synopsis:</h4>
<p>Astronomers analyze Spectral Energy Distributions (SEDs) by fitting them with models over a wide range in wavelength, from gamma rays to radio waves. The resulting best-fit values for the SED model parameters, and associated confidence limits, are physically meaningful quantities. The Iris SED analysis tool allows for robust modeling and fitting of SED data through association with Sherpa, an extensible, Python-based, multi-waveband modeling and fitting application for astronomers.</p>
<p>Learn how to fit models to SED data in Iris with custom model expressions, including preset and/or your own model components; how to set initial model parameter values and ranges, and choose an appropriate fit statistic and method; as well as calculate errors on best-fit model parameters.</p>
<p><b>Last Update:</b> 07 May 2015 - updated for Iris 2.1 beta. Users can now integrate under fitted models. Template library model parameter values are interpolated using k-nearest neighbor with k=2 and order=2. Templates, table models, and functions can all be arbitrarily combined in the Model Expression.</p>
<hr /></div></div>
<div class="section">
<h3><a name="Contents"></a><a name="toc"></a>Contents</h3>

<ul>
  
<li><b><a href="index.html#open_fit">Displaying Fitting Options</a></b></li>
  
<li><b><a href="index.html#define_model">Defining Model Expressions</a></b>
  
<ul>
    
<li><a href="index.html#custom_models">Importing Custom Models</a></li>
    
<li><a href="index.html#table_model">Table Model</a></li>
    
<li><a href="index.html#template_lib">Template Model Library</a></li>
    
<li><a href="index.html#python_model">Python User Model</a></li>
  </ul></li>
  
<li><b><a href="index.html#set_pars">Setting Model Parameters</a></b></li>
  
<li><b><a href="index.html#fit_stats">Choosing the Fit Statistic and Optimization Method</a></b></li>
  
<li><b><a href="index.html#fit">Fitting and Displaying the Model</a></b></li>
  
<li><b><a href="index.html#save">Saving the Model</a></b></li>
  
<li><b><a href="index.html#integrate_under_model">Integrating Under a Fitted Model</a></b></li>
  
<li><b><a href="index.html#history">History</a></b></li>
</ul>
<hr /></div></div>
<div class="section">
<h2><a name="Displaying_Fitting_Options"></a><a name="open_fit"></a> Displaying Fitting Options</h2>
<p>After one or more SED data segments and/or photometric points have been <a href="../../threads/entry/index.html" title="Loading SED Data into Iris">read into Iris</a>, and <a href="../../threads/plot/index.html" title="Visualizing SED Data">data display preferences set</a>, the data may be fit with a customized model expression using the Iris <i>Fitting Tool</i>. Clicking the <i>Fitting Tool</i> icon on the Iris desktop opens a new window in which individual model components may be added in order to define a custom model expression to fit to the data, and where initial model parameter values and the spectral fitting range are set. In Iris, model amplitudes are in units of photon flux density by default, and model spectral coordinates are in Angstroms.</p>
<p><a href="./imgs/open_fitting_v2.png"><img src="./imgs/open_fitting_v2_small.jpg" alt="Iris Screenshot" /></a></p>
<p>When the fitting window opens, the default model that is provided, <a href="../../references/models.html#powerlaw" title="powerlaw">powerlaw</a>.c1, is automatically plotted as a red line, and is calculated using the default power-law parameters. (At this point, the model has <i>not</i> been fit to the data, therefore it appears offset from the data curve.)</p>
<p>The Component section of the fitting window is the place to list the model components which will be used to construct the full model expression for fitting; these components can then be arbitrarily combined to form the full model expression, in the Model Expression field. The Component field is populated with a power-law model component by default, with model identifier &#x201c;c1&#x201d;. The model component naming convention uses an ordered component list from top to bottom, starting with &#x201c;c1&#x201d;. Removing various model components from the list will cause remaining components to potentially be renamed according to their position in the list, e.g., &#x201c;c2&#x201d;, &#x201c;c3&#x201d;, and so on.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Defining_Model_Expressions"></a><a name="define_model"></a> Defining Model Expressions</h2>
<p>A list of preset optical and X-ray Sherpa models is opened in a new window when the &#x201c;Add&#x201d; option in the fitting window is selected, from which you can choose a model to be added to the list of model components. Each model has a brief description which you can read by hovering the mouse over the model name (for more in depth descriptions of each model, see the <a href="../../references/models.html">Iris Models</a> page). There is also the option to choose from among any custom table, template, or Python user models which you may have imported into the session via the Iris &#x201c;Custom Models Manager&#x201d; tool (see the <a href="#custom_models">&#x201c;Importing Custom Models&#x201d;</a>section below to learn how to import custom models into Iris).</p>
<p><img src="./imgs/preset_modcomps.png" alt="Iris Screenshot" /> <img src="./imgs/custom_modcomps.png" alt="Iris Screenshot" /></p>
<p>Considering the example of fitting an absorbed broken power-law model to an SED of object 3C 273, you would choose &#x201c;<a href="../../references/models.html#atten" title="atten">atten</a>&#x201d; and &#x201c;<a href="../../references/models.html#brokenpowerlaw" title="brokenpowerlaw">brokenpowerlaw</a>&#x201d; from the list of preset Iris models, in order to add both model components to the Component section of the fitting window (where you may have deleted the default power-law component which is automatically added to the list upon startup, as was done in this example).</p>
<p><img src="./imgs/mod_comps.png" alt="Model Components" /></p>
<p>To model 3C 273 emission as a broken power-law using the &#x201c;<a href="../../references/models.html#brokenpowerlaw" title="brokenpowerlaw">brokenpowerlaw</a>&#x201d; component, and the ISM absorption using &#x201c;<a href="../../references/models.html#atten" title="atten">atten</a>,&#x201d; we need to define our model expression as the product of these two components. This is done in the Model Expression field, where model components can be added or multiplied together arbitrarily to create a composite model expression. This allows for modeling emission and/or absorption features, as well as the ability to apply a more complex model to the continuum itself. For an expression containing one model component, it is trivial: simply add the name of the model component, e.g., &#x201c;c1&#x201d;, to the Model Expression field. For a composite model such as an absorbed broken power-law, considered in this example, you would add &#x201c;c1*c2&#x201d; to represent the product of the &#x201c;<a href="../../references/models.html#atten" title="atten">atten</a>&#x201d; and &#x201c;<a href="../../references/models.html#brokenpowerlaw" title="brokenpowerlaw">brokenpowerlaw</a>&#x201d; components.</p>
<div class="section">
<h3><a name="Importing_Custom_Models"></a><a name="custom_models"></a> Importing Custom Models</h3>
<p>As it may be necessary to fit data with a model that does not come pre-packaged with Iris, the Custom Model Manager interface is available for configuring and importing your custom table, template, or Python function user models into the Iris fitting session.</p>
<p><img src="./imgs/CustomModel.png" alt="Custom Model Manager" /></p>
<p>After entering the path to the file containing the custom model definition, assigning the model component a string ID, and entering the model parameter information, the custom model component may be installed. The next time the Fitting Tool is opened, the model can be selected from the menu of custom model components and added to a model expression for fitting, under <i>Add -&gt; Custom Model Components -&gt; tables -&gt; &#x201c;your model string ID&#x201d;</i>.</p>
<p>The fields of the Custom Model Manager window are described below:</p>

<ul>
  
<li>
<p><b>Component ID</b> - an arbitrary string to identify the custom model for storage in Iris</p></li>
  
<li>
<p><b>&#x201c;Table&#x201d; radio button</b> - identifies the custom model as a table read from file. The data contained in custom table models must have the same units that Iris uses internally for modeling and fitting. The x-axis units must be in Angstroms, and the y-axis units must be in photons/s/cm^2^/Angstrom.</p></li>
  
<li>
<p><b>&#x201c;Template Library&#x201d; radio button</b> - identifies the custom model as a set of templates read from files. The data contained in custom template models must have the same units that Iris uses internally for modeling and fitting. The x-axis units must be in Angstroms, and the y-axis units must be in photons/s/cm^2^/Angstrom.</p></li>
  
<li>
<p><b>&#x201c;Python Function&#x201d; radio button</b> - identifies the custom model as a function that will be imported from Python</p></li>
</ul>
<p>In the text box beneath the radio buttons, type in the full path to the file containing the custom model, e.g., &#x201c;&lt;your_path_to_file&gt;/mypowlaw.py&#x201d; for the &#x201c;Python Function&#x201d; option.</p>

<ul>
  
<li>
<p><b>Component Parameters -&gt; Function Name</b> - the name of the Python function to be added as a user model, used only for the Python Function option</p></li>
  
<li>
<p><b>Component Parameters -&gt; Names</b> - names of the model parameters, separated by commas</p></li>
  
<li>
<p><b>Component Parameters -&gt; Values</b> - the initial parameter values corresponding the parameter names listed above, separated by commas</p></li>
  
<li>
<p><b>Component Parameters -&gt; Mins</b> - the minimum allowed values, separated by commas.</p></li>
  
<li>
<p><b>Component Parameters -&gt; Maxs</b> - the maximum allowed values, separated by commas.</p></li>
  
<li>
<p><b>Component Parameters -&gt; Fixed</b> - Boolean values, separated by commas, indicating whether parameters are fixed at the initial value during the fit (True = fixed at starting value, False = allowed to vary during the fit.)</p></li>
  
<li>
<p><b>Install Model Component</b> - install the model as a custom model in Iris. The next time the Fitting Tool is opened, the model can be selected from the menu of custom model components, under <i>Add -&gt; Custom Model Components -&gt; functions -&gt; &#x201c;your model component ID&#x201d;</i>.</p></li>
</ul>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Table_Model"></a><a name="table_model"></a> Table Model</h3>
<p>Iris supports ASCII-format table model files consisting of two separated columns of numbers, the X (spectral coordinate) and Y (flux) data values. When the table model is &#x201c;calculated&#x201d; during a fit, it returns the array of Y values multiplied by a single parameter for the model, amplitude. The amplitude parameter can be varied during the fit (i.e., a scale factor applied to the tabular data).</p>
<p>Example entries in the Custom Model Manger window are shown in the image below for a custom power-law table model.</p>
<p><img src="./imgs/define_table.png" alt="Defining a table model" /> <img src="./imgs/add_table_small.png" alt="Adding a table model" /></p>
<p>The example table model file &#x201c;sed_temp_data.dat&#x201d; - which can be found in the &#x201c;examples&#x201d; directory of your Iris installation - is shown below, where the X column contains wavelength values in units of Angstroms, and the Y column is flux density in units of photons/s/cm^2^/Angstrom (the internal units used for fitting in Iris are always photons/s/cm^2^Angstrom against Angstroms).</p>

<div class="source">
<div class="source"><pre class="prettyprint">% more &lt;basedir&gt;/miniconda/iris/opt/iris/examples/sed_temp_data.dat

   4.8588736e-06   8.4482890e-03
   1.7739201e-01   4.0325498e-03
   2.0675345e-01   9.2701427e-03
   3.2201128e-01   6.9831383e-03
   3.5436466e-01   9.1989617e-03
   4.1350690e-01   2.8576857e-03
   2.0675345e+00   4.1752139e-03
   2.3793056e+00   6.1398901e-03
   2.4776240e+00   1.1573206e-02
   3.1002327e+00   2.4582868e-03
   6.5314270e+00   3.7663007e-03
   9.2243846e+00   5.8898001e-03
   9.9269040e+00   2.2043961e-03
   1.2388120e+01   1.3400554e-03
   6.1940599e+01   1.1914311e-03
   9.9930833e+02   1.8273482e-02
   1.0302148e+03   3.5890026e-03
        .               .
        .               .
        .               .
</pre></div></div>
<p>Clicking &#x201c;Install Model Component&#x201d; installs the model as a custom model in Iris. The next time the Fitting Tool is opened, the model can be selected from the menu of custom model components, under <i>Add -&gt; Custom Model Components -&gt; tables -&gt; my_sedtab</i>.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Template_Model_Library"></a><a name="template_lib"></a> Template Model Library</h3>
<p>Iris also supports template model libraries so that you may compare a source data spectrum against a set of template models, in order to find the single template model which best matches the source data. During the fit, the data are compared to each template, to determine which template is the closest match to the data. The parameters associated with that template are returned as the best-fit parameters.</p>
<p>A collection of template models may be read into Iris by entering into the Custom Model Manager window the name of a single ASCII index file which lists the file contents of a directory full of template model files, in addition to the model parameter values associated with each template file. The various model files should also be in ASCII format, and contain separated columns of X and Y coordinates, where the X column lists the wavelength in Angstroms, and the Y column is the flux density in photons/s/cm^2^/Angstrom.</p>
<p>The Iris Custom Model Manager window would appear as shown below when loading a template model library, where the template model index filename is entered into the &#x201c;Add Custom Model Component&#x201d; section, and the template model parameter information is entered into the &#x201c;Component Parameters&#x201d; section. In the &#x201c;Component Parameters -&gt; Names&#x201d; field, the parameter names should match the names listed as parameters in the template index file.</p>
<p><img src="./imgs/define_template.png" alt="Defining a template library" /> <img src="./imgs/add_template_small.png" alt="Adding a template library" /></p>
<p>Clicking &#x201c;Install Model Component&#x201d; installs the model as a custom model in Iris. The next time the Fitting Tool is opened, the model can be selected from the menu of custom model components, under Add -&gt; Custom Model Components -&gt; tables -&gt; my_sedtemp.</p>
<p>Consider the example template model shown below, a representative of a set of power-law models, where there is a separate model file for each combination of model parameter values (power-law reference point and photon index, in this example).</p>

<div class="source">
<div class="source"><pre class="prettyprint">$ ls &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index*.dat

&lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.00.dat
&lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.10.dat
&lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.25.dat
&lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.35.dat
&lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.50.dat



 
$ ls &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.10.dat

4.8588736000000e-06 1.2188068071007e-03
1.7739201000000e-01 4.2628006741162e-04
2.0675345000000e-01 4.1980069644345e-04
3.2201128000000e-01 4.0160704511216e-04
3.5436466000000e-01 3.9778040979499e-04
4.1350690000000e-01 3.9168789965186e-04
.
.
.

</pre></div></div>
<p>Each of the ASCII-format template files listed above contains columns of wavelength in Angstroms and flux density in photons/s/cm^2^/Angstrom (the internal units for fitting in Iris are always photons/s/cm^2^/Angstrom against Angstroms), defining the predicted power-law spectra emitted by an X-ray source.</p>
<p>The template model index file which is entered into the Custom Model Manager window should contain a table with one line per template data file, with three groups of columns in the following order:</p>

<ul>
  
<li>Model parameter columns (there must be at least two)</li>
</ul>

<ul>
  
<li>
<p>The MODELFLAG column, which separates the parameter list from the filenames/model arrays, marks lines which are to be used or not: MODELFLAG = 1 - use the file; MODELFLAG = 0 - do not use the file (note that the MODELFLAG column in this file is <i>not</i> a model parameter)</p></li>
  
<li>
<p>The FILENAME column which points to the data file for that instance, including the full directory path to the file.</p></li>
</ul>
<p>Iris reads the index file in order to set up the template model with the parameters specified in the first line, and the arrays from the columns given by the data files.</p>
<p>An example index file appears below, with model flags (all having value 1) and filenames listed in the two right-most columns, and the power-law photon index and reference point model parameters listed from the left. The combination of the two parameter values sets the spectral shape of the model.</p>

<div class="source">
<div class="source"><pre class="prettyprint">$  more &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_templates.dat

# IDX REFER MODELFLAG FILENAME
0.0     5000  1   &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.00.dat
-0.10   5000  1   &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.10.dat
-0.25   5000  1   &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.25.dat
-0.35   5000  1   &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.35.dat
-0.50   5000  1   &lt;basedir&gt;/miniconda/envs/iris/opt/iris/examples/sed_temp_index-0.50.dat
</pre></div></div>
<p>Linear interpolation is used by the template model to match the data grid to the model grid - which must match before the fit statistics can be calculated for fitting. Instead of a simple grid-search method, K-nearest neighbor interpolation is used to evaluate the best-fit parameter values, with k=2 and order=2. The parameter values returned are a weighted interpolation between two best-fit templates.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Python_User_Model"></a><a name="python_model"></a> Python User Model</h3>
<p>You also have the option of importing into Iris a custom model function which you have defined and written in the Python scripting language. The name of the Python file in which it is saved is entered into the Iris Custom Model Manager interface with the &#x201c;Python function&#x201d; option selected, as shown below for an example using a power-law function. Note that the <i>Component Parameters -&gt; Function Name</i> field becomes active when this option is selected.</p>
<p><img src="./imgs/define_python_function.png" alt="Defining a Python model function" /> <img src="./imgs/add_python_function_small.png" alt="Adding a Python model function" /></p>
<p>The contents of an example Python user model file is shown below, where a power-law model function named &#x201c;mypowlaw&#x201d; is defined:</p>

<div class="source">
<div class="source"><pre class="prettyprint">$ more powlaw.py

import numpy

def mypowlaw(p, x):
    arg = x / p[0]
    arg = p[1] * numpy.power(arg, p[2])

    return arg
</pre></div></div>
<p>The &#x2018;p&#x2019; and &#x2018;x&#x2019; function arguments represent the arrays of parameter values and x-values, respectively. For this example, the model parameters entered into the Component Parameters section of the Custom Model Manager window are the normalization reference point, amplitude, and photon index of the power-law model. The &#x201c;Function Name&#x201d; entered into this section must match the Python function name in the file, &#x201c;mypowlaw&#x201d;.</p>
<p>Clicking &#x201c;Install Model Component&#x201d; installs the model as a custom model in Iris. The next time the Fitting Tool is opened, the model can be selected from the menu of custom model components, under Add -&gt; Custom Model Components -&gt; tables -&gt; my_py_powlaw.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div></div>
<div class="section">
<h2><a name="Setting_Model_Parameters"></a><a name="set_pars"></a> Setting Model Parameters</h2>
<p>Initial model parameter values and ranges may be set by selecting a model in the Component list, and then &#x201c;Edit&#x201d;. This will open a new window containing a list of the parameters for the selected model component, with associated fields for editing.</p>
<p><img src="./imgs/edit_pars_v2.png" alt="Edit model parameters" /></p>
<p>Entering a value into a model parameter field, and then pressing the &#x201c;Return&#x201d; key, will update that model parameter in the Component section of the fitting window. The &#x201c;Fit&#x201d; checkbox next to each parameter in the editing window is for specifying whether or not to freeze that parameter during the fit; if checked, the parameter will be allowed to vary. Selecting the button labeled with a blue arrow beneath the &#x2018;Fit&#x2019; checkbox opens a separate window in which parameter units, minimum and maximum values, and links to other parameters may be specified.</p>
<p><img src="./imgs/edit_par_range.png" alt="Edit model parameters" /></p>
<p>The &#x201c;Fix all&#x201d; and &#x201c;Default Fit&#x201d; options in the main fitting window may be used (while the model editor window remains open) to freeze all model parameters at current values, or thaw all model parameters (even those initially fixed), respectively.</p>
<p>The initial model parameter values are where Sherpa starts the fit in parameter space; the parameter ranges are the bounds of parameter space. It is not possible to fit using parameter values outside the specified parameter ranges.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Choosing_the_Fit_Statistic_and_Optimization_Method"></a><a name="fit_stats"></a> Choosing the Fit Statistic and Optimization Method</h2>
<p>The next step in the preparation for fitting involves choosing a fit statistic and optimization method appropriate for your analysis. Selecting &#x201c;Fit&#x201d; in the main fitting window (where model components are listed) launches a new model fitting window (labeled &#x201c;Fitted&#x201d;) containing the statistic and method options. These are listed below with brief descriptions (refer to the <a href="/sherpa4.3/statistics/">Statistics</a> and <a href="/sherpa4.3/methods/">Optimization</a> pages of the Sherpa website for a detailed explanation of each of the Sherpa fit statistics and methods available in Iris).</p>
<p><img src="./imgs/fitting.png" alt="Fitting Tool window" /></p>
<p><b>Fit Optimization Methods</b></p>

<ul>
  
<li><b>Levenberg-Marquardt</b> - a method to find the best-fit model parameter values, by finding the local minimum in parameter space; the functions to be minimized are nonlinear least-squares functions of the model parameters.</li>
  
<li><b>Nelder-Mead</b> - a method to find the best-fit model parameter values, by finding the local minimum in parameter space; a direct search method is used to continually move &#x201c;downhill&#x201d; in parameter space, until settling in a local minimum.</li>
  
<li><b>Monte Carlo</b> - a method using the differential evolution algorithm, to find a global minimum in parameter space; the search is seeded with randomly selected starting points, and can continue the search for the true minimum where the other methods could get stuck in local minima that do not represent the actual best fit. (Most useful for complex models and fits that could explore complicated regions of parameter space.)</li>
</ul>
<p><b>Fit Statistics</b></p>

<ul>
  
<li><b>least-squares</b> - Sum of the squares of the differences between data and model values.</li>
  
<li><b>Cash</b> - A maximum likelihood function based on Poisson statistics. More suitable for counts data than for fluxes.</li>
  
<li><b>C-stat</b> - A maximum likelihood function similar to Cash, but with a chi-squared-like probability distribution. More suitable for counts data than for fluxes.</li>
  
<li><b>chi2datavar</b> - Chi-squared statistic with variance computed from the data. If measured errors are provided, the variance is taken from these errors; else, the variance is computed from the y-values of the data points. This is the preferred chi-squared option to be used in Iris.</li>
  
<li><b>chi2gehrels</b> - Chi-squared statistic, where the variance is computed with a function from Gehrels et al. Suitable for low counts data (e.g., X-ray data) to correct for bias in using chi-squared.</li>
  
<li><b>chi2modvar</b> - Chi-squared statistic, where the variance is computed from the model values instead of data.</li>
  
<li><b>chi2constvar</b> - Chi-squared statistic, where the variance is set to be a constant value. That constant is the average of the y-values of the data points.</li>
  
<li><b>chi2xspecvar</b> - Chi-squared statistic, where the variance is computed as the X-ray spectral fitting program XSPEC would compute the variance (i.e., where the variance would be less than one, reset it to one). More suitable for low counts data (e.g., X-ray data).</li>
</ul>
<p>The Iris default fitting method and statistic are &#x201c;neldermead&#x201d; and &#x201c;leastsq&#x201d;, respectively, which represent good choices for a robust, quick, initial fit of a relatively simple model to a data set covering potentially many orders of magnitude in flux and/or wavelength. The fit can also be done with a chi-squared statistic, with various methods for estimating variance, or with either of two maximum likelihood statistics that are useful when the data have low numbers of counts. The fitting method can be changed to &#x201c;levmar&#x201d; or &#x201c;moncar&#x201d;, but note that switching the method is less important than switching the statistic, e.g., from least-squares to chi-squared.</p>
<p>Nelder-Mead is the optimal fitting method to start with because it does not depend on taking derivatives of the model function. As for the fit statistic, least-squares is preferred because it does not use measured errors and thus essentially weights all data points equally (it seeks to minimize the sum of the squares of the differences between data and model values, without taking errors into account). Chi-squared fitting, in contrast, can be decidedly biased towards the data points with the lowest fluxes and smallest measured error bars (when there are data points with measured errors that are orders of magnitude smaller than the error bars on most of the data points, then these points become the biggest contributors to the chi-squared value).</p>
<p>In subsequent fits - e.g., after selecting a different data range to fit, adding in new model components as needed, and so on - the statistic can be switched to a chi-squared option to use measured errors (preferably chi2datavar, which is chi-squared with data variance). Since measured errors are provided, this means the variance is taken directly from the errors provided with the data, when the data file is read in.</p>
<p><b>Note</b>: When one or multiple SED segments is fit in Iris, any data points with associated zero-value errors are ignored in the fit. This design choice is intended as a safeguard against yielding potentially misleading fit results in the analysis of your SED data. Iris interprets a zero-value error* not <i>to mean that the uncertainty on the associated data value is actually zero, but that a measure of the uncertainty is not available for that particular photometric point.</i></p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Fitting_and_Displaying_the_Model"></a><a name="fit"></a> Fitting and Displaying the Model</h2>
<p>Before initiating a fit of the defined model to a SED in Iris, the specific subset of the SED data to be included in the fit (if not the entire SED) should be specified using the &#x201c;Define Range&#x201d; option in the main fitting window. Selecting this option will prompt you to click on the data display twice, once to define the lower endpoint of the data range to be fit, and once for the upper endpoint.</p>
<p><a href="./imgs/define_range_v2.png"><img src="./imgs/define_range_v2_small.jpg" alt="Defining the fitting range" /></a></p>
<p>Having built a model expression and set initial parameter values, chosen an appropriate fit statistic and optimization method for your analysis, and defining the range of data to be fit, you are ready to initiate the fitting process by selecting &#x201c;Start&#x201d; in the Fitted window. When the fit is complete, a red model curve appears overplotted on the SED data in the Iris main display (beyond the specified data range to be fit; this extraneous portion of the fitted model may be ignored).</p>
<p><a href="./imgs/model_plot_v2.png"><img src="./imgs/model_plot_v2_small.jpg" alt="SED Viewer with fitted model overplotted" /></a></p>
<p>When the fit has finished, the model parameter values will appear updated in the Component field of the fitting window, and fit statistics will be displayed in the fitting tab of the Fitted window, including the number of data points used in the fit, the degrees of freedom, and the probability that the fit is consistent with the data (q-value), where applicable (when fitting with the least-squares or Cash statistic, the &#x201c;reduced statistic&#x201d; value and q-value are not available, as they cannot be computed).</p>
<p><img src="./imgs/fit_saved_v2_small.jpg" alt="Statistics" /> <img src="./imgs/fit_stats_leastsq_v2.png" alt="Fit statistics window" /></p>
<p>When fitting with one of the chi-squared statisics, or the chi-squared-like cstat statistic, the Confidence tab returns the requested sigma/percent confidence intervals on the best-fit model parameters, calculated using the statistic and method chosen for the fit. For example, entering &#x201c;1.6&#x201d; in the &#x201c;sigma&#x201d; field will return th 90% confidence limits on the model parameter values..</p>
<p><img src="./imgs/confidence_chi2.png" alt="Confidence limits" /></p>
<p>If the statistic is left at the default &#x201c;leastsq&#x201d;, Iris will issue an error stating that least-squares cannot be used with the confidence limit function (this is because the only way calculate to confidence limits is to know the probability distribution for the fit statistic, which is known for the chi-squared and chi-squared-lke cstat statistic, but not least squares).</p>
<p>Also of note is that blank or &#x201c;NaN&#x201d; values are returned in the confidence results when a parameter bound is found to lie outside the hard limit boundary for a model parameter (which ought not to be changed by the user, so there is not an option to do so in Iris). This could result from an issue with the signal-to-noise of the data, the applicability of the model to the data, systematic errors in the data, among others things. A parameter hard limit represents either a hard physical limit (e.g., temperature is not allowed to go below zero), a mathematical limit (e.g., prevent a number from going to zero or below, when the log of that number will be taken), or the limit of what a float or double can hold (the fit should not be driven above or below the maximum or minimum values a variable can hold).</p>
<p>You can iterate through the fitting process in Iris as many times as necessary - adding or deleting models from the model expression; changing parameter values or ranges; including or excluding new points from the SED - until you find a satisfactory model that best describes your SED data.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Saving_the_Model"></a><a name="save"></a> Saving the Model</h2>
<p>Once a spectral model is satisfactorily fitted, the custom fitted model parameters can be saved to a local file <i>before exiting</i> the fitting session, by making an appropriate selection in the File menu of the fitting window.</p>
<p><img src="./imgs/fit_write_menu.png" alt="Save Model menu" /></p>
<p>Selecting the <i>File -&gt; Write to text file</i> option saves the spectral model to file in a human-readable text format. The &#x201c;Write active components&#x201d; option in this submenu writes only the model components which were used in the fit; example output is shown below:</p>

<div class="source">
<div class="source"><pre class="prettyprint">$ more 3c273_atten_bpl_active_comps.txt

File: 3C 273

Thu Feb 26 15:46:31 EDT 2015  Iris 2

TARGNAME: 3C 273

Model Expression:
        c1*c2

Fit parameters:
        Final fit statistic:      0.010714114984176791
        Reduced statistic:        nan
        Probability [Q-value]:    nan
        Degrees of freedom:       413.0
        Data points:              419
        Last function evaluation: 394

Component 1:    atten.c1 
       hcol      = 1.0E20     (NaN NaN)                                   
       heiRatio  = 0.04177875 (NaN NaN)                                   
       heiiRatio = 0.74654233 (NaN NaN)                                   

Component 2:    brokenpowerlaw.c2 
   F   refer  = 300000.0                            angstroms             
       ampl   = 0.0062282784 (0.1065081 NaN)                              
       index1 = -0.039390083 (NaN       -4.82435)                         
       index2 = -0.6063001   (2.4033892 NaN)                              
</pre></div></div>
<p>Selecting <i>File -&gt; Write to file</i>, instead, saves the model to a file in a format (CDB) that can be read back by the tool in a future data analysis session. (CDB is an XML format for reading model files in and out of Iris.)</p>
<p><img src="./imgs/save_models_cdb.png" alt="Saving a fitted model" /></p>
<p>This customized Iris fitting session may be restored by selecting the <i>File-&gt;Read from file</i> menu option within the Iris fitting window.</p>
<p><img src="./imgs/open_models_cdb.png" alt="Reloading a saved, fitted model" /></p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Integrating_Under_a_Fitted_Model"></a><a name="integrate_under_model"></a> Integrating Under a Fitted Model</h2>
<p>After fitting a SED, you can estimate fluxes through user-defined passbands and photometric filters by integrating under the model components. This is done from the &#x201c;Calculate Flux&#x201d; tab in the Science tools, which is opened by clicking the <a href="../../threads/science/index.html" title="Shift, Interpolate, and Integrate">&#x201c;Shift, Interpolate, Integrate&#x201d;</a> icon on the desktop. The user may integrate under the full model or an arbitrary combination of the model components. The Fitting Tool must remain open for model integration.</p>
<p><a href="./imgs/integrate_under_model-default.png"><img src="./imgs/integrate_under_model-default_small.jpg" alt="[Calculate Flux screenshot]" /></a></p>
<p>After opening the &#x201c;Calculate Flux&#x201d; tab, make sure Model Integration is selected (it should &#x201c;Integrate Model (YES)&#x201d;). By default, the full model will be used to evaluate the fluxes. For our fit of 3c273, the model expression is <tt>&quot;c1*c2&quot;</tt>. A quick-look view of the model and the parameter values can be displayed by clicking the &#x201c;Show Model&#x201d; button.</p>
<p><a href="./imgs/integrate_under_model-show_model.png"><img src="./imgs/integrate_under_model-show_model.png" alt="Calculate Flux screenshot" /></a></p>
<p>You can change the number of spectral bins used to calculate the integral by adjusting the value in the &#x201c;Model evaluation bin #&#x201d; box.</p>
<p>By checking-off &#x201c;Full model,&#x201d; the user can arbitrarily combine the model components, then integrate the expression in the &#x201c;Model Expression&#x201d; field. This means that users can integrate under <i>individual model components</i>. Multiplication and addition of other model components and numeric values are acceptable. For example, the expressions <tt>&quot;c2 * 3.678&quot;</tt>, <tt>&quot;c2 + c1&quot;</tt>, and <tt>&quot;c1 + c2 * 1.2&quot;</tt> are allowed.</p>
<p>Say we want to estimate the total infrared flux and the flux through the Herschel PACS and SPIRE bands . Going back to the &#x201c;Calculate Flux&#x201d; in the Science tool, we add the Hershcel photometry filters (select &#x201c;Photometry Filter&#x201d; -&gt; &#x201c;Choose&#x201d; and search for &#x201c;Herschel&#x201d;) and add a user-defined pass band from 0.8 to 1000 microns (8000 - 1E7 Angstroms). To integrate under the fitted model, we turn &#x201c;Model Integration&#x201d; on (YES), and click &#x201c;Calculate.&#x201d;</p>
<p><a href="./imgs/integrate_under_model-results.png"><img src="./imgs/integrate_under_model-results_small.jpg" alt="Calculate Flux screenshot" /></a></p>
<p>The results can be exported as a new SED with the &#x201c;Create SED&#x201d; button, or may be saved to a text file with &#x201c;Save.&#x201d; The text file can be loaded back into Iris as an ASCII Table.</p>
<p><b>NOTE:</b> If the user exits the main Fitting Tool window, the user will no longer be able to integrate under the fitted model, as the models will be lost from closing the fitting session. Iris will ask the user if they really want to leave the fitting session if they try to close the Fitting Tool.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="History"></a><a name="history"></a> History</h2>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Date </th>
      
<th>Changes </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td>09&#xa0;Aug&#xa0;2011 </td>
      
<td>updated for Beta 2.5 </td>
    </tr>
    
<tr class="a">
      
<td>25&#xa0;Sep&#xa0;2011 </td>
      
<td>updated for Iris 1.0 </td>
    </tr>
    
<tr class="b">
      
<td>08&#xa0;Jun&#xa0;2012 </td>
      
<td>updated for Iris 1.1 </td>
    </tr>
    
<tr class="a">
      
<td>02&#xa0;Jan&#xa0;2013 </td>
      
<td>updated for Iris 1.2 </td>
    </tr>
    
<tr class="b">
      
<td>21&#xa0;Jun&#xa0;2013 </td>
      
<td>updated for Iris 2.0 </td>
    </tr>
    
<tr class="a">
      
<td>05&#xa0;Aug&#xa0;2013 </td>
      
<td>updated Iris screenshots </td>
    </tr>
    
<tr class="b">
      
<td>02&#xa0;Dec&#xa0;2013 </td>
      
<td>updated for Iris 2.0.1 </td>
    </tr>
    
<tr class="a">
      
<td>07&#xa0;May&#xa0;2015 </td>
      
<td>updated for Iris 2.1 beta. Users can now integrate under fitted models. Template library model parameter values are interpolated using k-nearest neighbor with k=2 and order=2. Templates, table models, and functions can all be arbitrarily combined in the Model Expression. </td>
    </tr>
  </tbody>
</table>
<hr />

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<!-- external links -->
<!-- threads -->
<!-- extras (Iris models) -->
<!-- reference files -->
<!-- CXC links -->
<!-- Navigation --></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
