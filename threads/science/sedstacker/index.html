<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2015-10-20 
 | Rendered using Apache Maven Fluido Skin 1.4
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20151020" />
    <meta http-equiv="Content-Language" content="en" />
    <title>java-sandbox &#x2013; <a name="top"></a> Statistically Combining SEDs with Iris</title>
    <link rel="stylesheet" href="../../../css/apache-maven-fluido-1.4.min.css" />
    <link rel="stylesheet" href="../../../css/site.css" />
    <link rel="stylesheet" href="../../../css/print.css" media="print" />

      
    <script type="text/javascript" src="../../../js/apache-maven-fluido-1.4.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
    
    
        
    
        
    <a href="https://github.com/olaurino/sandbox">
      <img style="position: absolute; top: 0; left: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"
        alt="Fork me on GitHub">
    </a>
  
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                                  <a href="../../../" id="bannerLeft">
                                                                                                <img src="../../../imgs/Iris_logo_padding.png"  alt="Chandra CXC"/>
                </a>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2015-10-20
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 1.0-SNAPSHOT
                      </li>
                      
                
                    
      
                                    
    <li class="pull-right">
                      <a href="http://cxc.cfa.harvard.edu" class="externalLink" title="Chandra CXC">
        Chandra CXC</a>
      </li>

                    </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Iris</li>
                              
      <li>
  
                          <a href="../../../index.html" title="Homepage">
          <span class="none"></span>
        Homepage</a>
            </li>
                              <li class="nav-header">Introduction</li>
                              
      <li>
  
                          <a href="../../../intro/index.html" title="About">
          <span class="none"></span>
        About</a>
            </li>
                
      <li>
  
                          <a href="../../../intro/features.html" title="Features">
          <span class="none"></span>
        Features</a>
            </li>
                
      <li>
  
                          <a href="../../../intro/future.html" title="Future">
          <span class="none"></span>
        Future</a>
            </li>
                              <li class="nav-header">Download Iris</li>
                              
      <li>
  
                          <a href="../../../download/index.html" title="Download & Installation">
          <span class="none"></span>
        Download & Installation</a>
            </li>
                
      <li>
  
                          <a href="../../../download/smoke_tests.html" title="Smoke Test">
          <span class="none"></span>
        Smoke Test</a>
            </li>
                
      <li>
  
                          <a href="../../../bugs/smoke.html" title="Troubleshooting">
          <span class="none"></span>
        Troubleshooting</a>
            </li>
                              <li class="nav-header">Documentation</li>
                                                                                                                                                                                                                                          
      <li>
  
                          <a href="../../../guide.html" title="How-To Guide">
          <span class="icon-chevron-down"></span>
        How-To Guide</a>
                    <ul class="nav nav-list">
                    
      <li>
  
                          <a href="../../../threads/entry/index.html" title="Loading SED Data into Iris">
          <span class="none"></span>
        Loading SED Data into Iris</a>
            </li>
                    
      <li>
  
                          <a href="../../../threads/importer/index.html" title="Building and Managing SEDs">
          <span class="none"></span>
        Building and Managing SEDs</a>
            </li>
                    
      <li>
  
                          <a href="../../../threads/plot/index.html" title="Visualizing SED Data">
          <span class="none"></span>
        Visualizing SED Data</a>
            </li>
                    
      <li>
  
                          <a href="../../../threads/fit/index.html" title="Modeling and Fiting SED Data">
          <span class="none"></span>
        Modeling and Fiting SED Data</a>
            </li>
                    
      <li>
  
                          <a href="../../../threads/save/index.html" title="Saving SED Data">
          <span class="none"></span>
        Saving SED Data</a>
            </li>
                    
      <li>
  
                          <a href="../../../threads/science/index.html" title="Shifting, Interpolating, and Integrating SED Data">
          <span class="none"></span>
        Shifting, Interpolating, and Integrating SED Data</a>
            </li>
                    
      <li class="active">
  
            <a href="#"><span class="none"></span>Statistically Combining SEDs</a>
          </li>
                    
      <li>
  
                          <a href="../../../threads/sdk/index.html" title="Creating Iris Plugins: The Iris Software Development Kit">
          <span class="none"></span>
        Creating Iris Plugins: The Iris Software Development Kit</a>
            </li>
                    
      <li>
  
                          <a href="../../../threads/plugin_manager/index.html" title="Installing Iris Plugins">
          <span class="none"></span>
        Installing Iris Plugins</a>
            </li>
              </ul>
        </li>
                
      <li>
  
                          <a href="../../../bugs/index.html" title="Bugs & Caveats">
          <span class="none"></span>
        Bugs & Caveats</a>
            </li>
                
      <li>
  
                          <a href="../../../faq/index.html" title="FAQs">
          <span class="none"></span>
        FAQs</a>
            </li>
                
      <li>
  
                          <a href="../../../releasenotes/index.html" title="Release Notes">
          <span class="none"></span>
        Release Notes</a>
            </li>
                              <li class="nav-header">References</li>
                              
      <li>
  
                          <a href="../../../references/models.html" title="Iris Models">
          <span class="none"></span>
        Iris Models</a>
            </li>
                
      <li>
  
                          <a href="../../../references/importer_files.html" title="Supported File Formats">
          <span class="none"></span>
        Supported File Formats</a>
            </li>
                
      <li>
  
                          <a href="../../../publications/index.html" title="Publications">
          <span class="none"></span>
        Publications</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                                                                                                                            
      <li>
  
                          <a href="../../../project-info.html" title="Project Information">
          <span class="icon-chevron-right"></span>
        Project Information</a>
                  </li>
                                                                  
      <li>
  
                          <a href="../../../project-reports.html" title="Project Reports">
          <span class="icon-chevron-right"></span>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                            <form id="search-form" action="https://www.google.com/search" method="get" >
    
  <input value="http://olaurino.github.io/java-sandbox/" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script type="text/javascript" src="https://www.google.com/coop/cse/brand?form=search-form"></script>
          
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="../../../images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span10" >
                                  
            <h1><a name="top"></a> Statistically Combining SEDs with Iris</h1>
<hr />
<div class="section">
<h2><a name="Overview"></a><a name="overview"></a> Overview</h2>
<div class="section">
<div class="section">
<h4><a name="Synopsis:"></a>Synopsis:</h4>
<p>Spectral energy distributions, or SEDs, are commonly used in astronomy to study the physics of various astronomical objects. In some situations, it is useful to study the average shape of an SED. Astronomers will often combine SEDs of similar objects to create templates or study their general characteristics. Spectra, which may be thought of as densely-packed SEDs, may also be averaged to increase signal-to-noise ratio and examine common features of a specific group of objects.</p>
<p>This thread demonstrates how users may redshift, normalize, and statistically combine groups of SEDs with Iris&#x2019; tool <i>SED Stacker</i>.</p>
<p><b>Last Update:</b> 07 May 2015 - First issue. Added in Iris 2.1 beta.</p>
<hr /></div></div>
<div class="section">
<h3><a name="Contents"></a><a name="toc"></a> Contents</h3>

<ul>
  
<li><b><a href="index.html#intro">Introduction</a></b></li>
  
<li><b><a href="index.html#startup">Startup</a></b></li>
  
<li><b><a href="index.html#create_manage">Creating and Managing Stacks</a></b>
  
<ul>
    
<li><a href="index.html#create_stack">Creating a Stack</a></li>
    
<li><a href="index.html#add_seds">Adding SEDs to a Stack</a></li>
    
<li><a href="index.html#manage">Managing Stacks</a></li>
  </ul></li>
  
<li><b><a href="index.html#redshift">Redshifting Stacks</a></b></li>
  
<li><b><a href="index.html#normalize">Normalizating Stacks</a></b></li>
  
<li><b><a href="index.html#stack">Combining Stacks: stacking</a></b></li>
  
<li><b><a href="index.html#useful-tips">Useful Tips and Tricks</a></b>
  
<ul>
    
<li><a href="index.html#segments-as-seds">Treating Segments as SEDs in SED Stacker</a></li>
  </ul></li>
  
<li><b><a href="index.html#other-uses">Other Uses of SED Stacker</a></b>
  
<ul>
    
<li><a href="index.html#redshift-1">Redshifting without correcting the flux</a></li>
    
<li><a href="index.html#normalize-1">Normalizing a single SED</a></li>
    
<li><a href="index.html#normalize-2">Normalizing multiple SEDs</a></li>
  </ul></li>
  
<li><b><a href="index.html#troubleshooting">Troubleshooting</a></b>
  
<ul>
    
<li><a href="index.html#redshift-troubleshoot">Redshifting</a></li>
    
<li><a href="index.html#normalize-troubleshoot">Normalizing</a></li>
    
<li><a href="index.html#stacking-troubleshoot">Stacking</a></li>
  </ul></li>
  
<li><b><a href="index.html#history">History</a></b></li>
</ul>
<hr /></div></div>
<div class="section">
<h2><a name="Introduction"></a><a name="intro"></a> Introduction</h2>
<p>The SED Stacker component is a GUI interface between Iris and the Python toolkit <tt>sedstacker</tt> (available on <a class="externalLink" href="https://github.com/jbudynk/sedstacker">Github</a>.</p>
<p><tt>sedstacker</tt> was developed for interest in creating SED template models, increasing the signal-to-noise ratio of faint spectra, and studying the average SED characteristics of specific groups of astronomical objects. The SED Stacker component in Iris allows users to group SEDs together and statistically combine or &#x201c;stack&#x201d; them into a single SED.</p>
<p>SED Stacker also provides a variety of ways to normalize their SEDs, and lets users redshift SEDs in bulk.</p>
<hr /></div>
<div class="section">
<h2><a name="Startup"></a><a name="startup"></a> Startup</h2>
<p>We use two datasets to explore SED Stacker&#x2019;s capabilities: one set is several &#x201c;featureless&#x201d; AGN from Kirkpatrick et al. (2012; <a class="externalLink" href="http://adsabs.harvard.edu/abs/2012ApJ...759..139K">2012ApJ&#x2026;759..139K</a>), and the other are several obscured and unobscured AGN from the COSMOS field used in Bongiorno et al. (2012; <a class="externalLink" href="http://adsabs.harvard.edu/abs/2012MNRAS.427.3103B">2012MNRAS.427.3103B</a>). You can download the <a href="./featureless_agn.tar.gz">featureless AGN</a> and <a href="./cosmos_agn.fits">COSMOS AGN</a> to follow along.</p>
<p>The user opens the Iris SEDStacker component by clicking either the desktop icon or Tools -&gt; Science -&gt; SEDStacker in the Iris toolbar. Clicking either item initiates the SED Stacker window and creates a new empty SED container, called a Stack, with the ID &#x201c;Stack.&#x201d;</p>
<p><img src="./imgs/sedstacker-icon.png" alt="snapshot of SED Stacker Component" /></p>
<hr /></div>
<div class="section">
<h2><a name="Creating_and_Managing_Stacks"></a><a name="create_manage"></a> Creating and Managing Stacks</h2>
<div class="section">
<h3><a name="Creating_a_Stack"></a><a name="create_stack"></a> Creating a Stack</h3>
<p>Figure 1 shows the GUI frame for SED Stacker in Iris. On the left is a list of open Stacks. A user can create a new Stack by clicking &#x201c;Create New Stack.&#x201d; The user can change the name of the Stack by right-clicking the Stack name in the &#x201c;Open Stacks&#x201d; list. Like the SED Builder, Stacks have unique names. Stacks initialized with the same name are appended with &#x201c;A, B, C,&#x2026;&#x201d; and so on (e.g., &#x201c;Stack,&#x201d; &#x201c;Stack.A&#x201d;, &#x201c;Stack.B,&#x201d; etc.).</p>
<p><img src="./imgs/sedstacker-frame_blank_small.png" alt="snapshot of SED Stacker Component" /> <b>Figure 1.</b> The SED Stacker component.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Adding_SEDs_to_a_Stack"></a><a name="add_seds"></a> Adding SEDs to a Stack</h3>
<p>The user adds multiple SEDs from the list of open SEDs in the SED Builder by clicking the &#x201c;Add&#x2026;&#x201d; button in the &#x201c;Added SEDs&#x201d; section. This opens up a window displaying all the open SEDs&#x2019; IDs and redshifts. If the user has already shifted a SED in Iris, the redshift will appear by the SED ID in the &#x201c;Redshift&#x201d; column. The user can input the redshift in this column by double-clicking it and entering the value. When finished with adding redshifts, the user selects the SEDs they wish to add by holding the Shift or Command / Control key on their keyboard, and clicking on the SED IDs. Highlighted rows are added to the Stack through the &#x201c;Add&#x201d; button.</p>
<p>The user does not need to assign redshifts to all the SEDs in a Stack. When a Stack is redshifted, SEDs without a redshift are simply passed along with no changes.</p>
<p><img src="./imgs/add-seds-frame2_small.jpg" alt="[snapshot of SED Stacker Component]" /> <b>Figure 2.</b> Adding SEDs and their redshifts to a Stack using the &#x201c;Adding SEDs&#x201d; window.</p>
<p>The list of SEDs in the Stack is displayed in a table under &#x201c;Added SEDs.&#x201d; The table shows the IDs, the original redshifts, the normalization constants (default, 1.0), and the number of points in each SED.</p>
<p><img src="./imgs/added-seds-table_whole-frame.jpg" alt="snapshot of SED Stacker Component" /> <b>Figure 3.</b> The SED Stacker frame after populating a Stack with SEDs.</p>
<p>The user may choose to import the Segments of a SED as individual SEDs in the Stack. In this case, the user checks &#x201c;Treat Segments as SEDs&#x201d; on the Add SEDs window before adding the highlighted SEDs to the Stack. The user then adds the redshift values for the segments by typing the redshift into the corresponding cell in the Redshift column.</p>
<p><img src="./imgs/treat-segments_add_small.jpg" alt="snapshot of SED Stacker Component" /> <img src="./imgs/treat-segments_added-redshifts_small.jpg" alt="snapshot of SED Stacker Component" /></p>
<p><b>Figure 4.</b> <i>Top</i>: Adding SED segments as individual SEDs to a Stack. Notice that &#x201c;Treat Segments as SEDs&#x201d; is checked. <i>Bottom</i>: Assigning redshifts to the SED Segments in the Added SEDs table.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Managing_Stacks"></a><a name="manage"></a> Managing Stacks</h3>
<p>Any number of Stacks can be added to SED Stacker. Stacks can be renamed by right-clicking on the Stack name in the Open Stacks, selecting &#x201c;Rename&#x2026;&#x201d; and inputting the new, unique ID.</p>
<p><img src="./imgs/rename-popup_small.jpg" alt="renaming a Stack" /> <img src="./imgs/rename-input_small.jpg" alt="[renaming a Stack]" /> <b>Figure 5.</b> Changing the name of a Stack.</p>
<p>The user can remove SEDs from a Stack by clicking on the SED rows in the table while holding Command/Control or Shift, then clicking the &#x201c;Remove&#x201d; button.</p>
<p>At any time, the user may visualize the current state of their Stack by clicking &#x201c;Create SED&#x201d; in the bottom-right corner of the window. This creates a SED-representation of their currently selected Stack which can be seen in the SED Builder and SED Viewer. There are also convenient check-boxes next to each operational button that let the user create a SED each time they redshift or normalize.</p>
<p><img src="./imgs/create-sed_featureless_small.jpg" alt="adding a SED-represntation of the Stack to the SED Builder" /> <b>Figure 6.</b> A SED-represntation of the Stack is added to the SED Builder and Viewer for more analysis using the &#x201c;Create SED&#x201d; button in the SED Stacker window.</p>
<p>Users can restore the SEDs back to their original values by clicking &#x201c;Reset&#x201d; in the bottom-right corner. This resets all redshifting and normalizations done to the Stack.</p>
<p>Stacks can be removed from the session by clicking the &#x201c;Delete&#x201d; button in the bottom-right corner. Iris will ask for the user&#x2019;s confirmation before deleting a Stack.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div></div>
<div class="section">
<h2><a name="Redshifting_Stacks"></a><a name="redshift"></a> Redshifting Stacks</h2>
<p>Before combining the SEDs together, the user can optionally redshift or normalize the SEDs using the methods provided in SED Stacker.</p>
<p><img src="./imgs/redshift-and-normalize-options_redshift.png" alt="screenshot of SED Stacker component" /> <b>Figure 7.</b> Redshift options.</p>
<p>The user can shift multiple SEDs simultaneously to the same redshift. The user types in the target redshift into the &#x201c;Move to redshift:&#x201d; field. The SEDs are converted into wavelength-space before redshifting. The user can also choose if they want to correct the flux for the change in brightness due to the source&#x2019;s observed redshift. This correction is done using the same method as used in the Shift, Interpolate, &amp; Integrate Tool:</p>
<p><i>The integral of the original SED is recorded. Then, the spectral values are shifted to the target redshift, and the integral of the shifted SED is computed. Finally, the flux is multiplied by the ratio of the shifted and original integrals.</i></p>
<p>By default, this option is checked.</p>
<p><img src="./imgs/stack-redshifted_small.jpg" alt="screenshot of SED Stacker component" /> <b>Figure 8.</b> Shifting the Featureless AGN to z=0.0. We correct the flux and automatically create a SED-representation of the shifted Stack. The redshifted AGN are shown in the SED Builder and Viewer.</p>
<p>SEDs that do not have assigned redshifts are not shifted. These SEDs are kept in the stack with the shifted SEDs. A message with the unshifted SED IDs is presented to the user in this case.</p>
<p>Users can change the redshift of the SEDs after having added them to a Stack. Double-click the &#x201c;Redshift&#x201d; cell value in the &#x201c;Added SEDs&#x201d; table to change the redshift <b>[1]</b>.</p>
<p>If &#x201c;Create SED&#x201d; is selected, a new SED named &#x201c;&lt;stack_name&gt;_z=&lt;redshift&gt;_&#x201d; will be added to the Builder and Viewer for visualization, where &lt;redshift&gt; is the value the Stack was shifted by.</p>
<p><b>Note:</b> The redshifts in the &#x201c;Added SEDs&#x201d; table always show the original redshifts.</p>
<p><b>[1]</b> Changing the original redshift does NOT automatically reset the SED to its original state. If the redshift is changed after a user has already shifted the SED, and the user wants to redshift the SED again, the user MUST reset the Stack first.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Normalizating_Stacks"></a><a name="normalize"></a> Normalizating Stacks</h2>
<p>Users can normalize the SEDs in the stack with one of two methods: by setting the integrated flux of each SED to a certain value, or by setting the flux of each SED at some spectral value to a flux value. These two methods are called <b>Integration</b> and <b>At Point</b>.</p>
<p><img src="./imgs/redshift-and-normalize-options_normalize.png" alt="screenshot of SED Stacker component" /> <b>Figure 9.</b> Normalization options.</p>
<p>The <b>Integration</b> method requires the spectral range to integrate over (by default, the minimum and maximum spectral values of each SED), and the value to set the integrated flux to (default 1.0 erg/s/cm2). The user controls the units they wish to use for integration with the X and Y drop-down boxes. By default, the SEDs are normalized by setting the integral to whatever value is in the &#x201c;Normalize to:&#x201d; text box. This option is called &#x201c;Value.&#x201d; The user may also choose to normalize the SEDs so that the integrated flux of each SED is equivalent to the median or average integrated flux of all the SEDs by selecting the corresponding item in the drop-down list. The integrals are calculated using the trapezoidal rule.</p>
<p><img src="./imgs/sedstacker-frame_normalized_small.jpg" alt="screenshot of SED Stacker component" /> <b>Figure 10.</b> Featureless AGN normalized to the median integral of all the SEDs plotted in mJy vs microns. The normalization constants are the values multiplied to the SEDs in the flux unit used for normalization, which in this case is mJy.</p>
<p>For the <b>At Point</b> method, the user provides the spectral value at which to normalize the SEDs (by default, 5000 Angstroms), and the value of the flux at that spectral value (default 1.0 erg/s/cm2/Angstrom). Again, the user may choose to normalize the SEDs so that the flux at the spectral value is equal to the average or median of all selected SEDs at the spectral value by selecting the corresponding item in the drop-down box next to &#x201c;At point:&#x201d;. The SEDs are interpolated via a nearest-neighbor method to calculate the normalization constant at point (X, Y).</p>
<p><img src="./imgs/sedstacker-frame_shifted-and-normed_small_cut.jpg" alt="[screenshot of SED Stacker component]" /> <img src="./imgs/stack_normalized-to-point_small.jpg" alt="[screenshot of SED Stacker component]" /> <b>Figure 11.</b> Featureless AGN normalized to the point (100 microns, 10 mJy). The normalization constants are the values multiplied to the SEDs in the flux unit used for normalization, which in this case is mJy. <i>Note that the Stack was reset and re-shifted since the last normalization.</i></p>
<p>Both normalization methods allow the user to either add or multiply the normalization constant to the SEDs. By default, multiplication is used. The user controls this behavior with the &#x201c;Add&#x201d; and &#x201c;Multiply&#x201d; buttons above the normalization parameters. In the examples above, we used &#x201c;Multiply,&#x201d; so the normalization constants listed in the table are multiplied by the redshifted SED fluxes.</p>
<p>If &#x201c;Create SED&#x201d; is selected, a new SED named &#x201c;&lt;stack_name&gt;_normalized&#x201d; will be added to the Builder and Viewer for visualization.</p>
<p>If the spectral range of a SED falls outside the defined normalization range, the SED will not be normalized. A message with the list of SEDs that weren&#x2019;t normalized will pop-up if this happens.</p>
<p>SED Stacker allows users to re-normalize their SEDs. Users can normalize their SEDs with one set of parameters, then renormalize with a new set. Changing the parameters does NOT undo the previous normalization.</p>
<p>The normalization constant applied to each SED is shown in the column &#x201c;Normalization Constant&#x201d;. <b>Useful tip:</b> The normalization constant only updates when the SED is normalized with new parameters. For example, a user may normalize a Stack, add a few more SEDs to the stack, and renormalize the Stack with the same parameters to update the newly added SEDs. The SEDs and normalization constants of the older SEDs remain the same, unless the user selected an average or median for normalization.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Combining_Stacks:_stacking"></a><a name="stack"></a> Combining Stacks: stacking</h2>
<p>On the right side of the SEDStacker GUI are the stacking options.</p>
<p><img src="./imgs/stacking-options_default_small.jpg" alt="screenshot of SED Stacker component" /> <b>Figure 12.</b> Stacking options.</p>
<p>This is how SED Stacker statistically combines, or &#x201c;stacks,&#x201d; SEDs. A set of equally-spaced bins are created using the user-input bin size. The binning runs from the minimum to the maximum spectral values of the SEDs; the min value is rounded-down, and the max value is rounded up. All of the SED points that fall within a bin are combined according to the the chosen statistic into one data point, set at the left-edge of the bin. The statistic options are average, weighted average, and sum. The distribution of data points are assumed to be Gaussian, and so the errors of each combined bin are the standard deviation of the flux values in each bin.</p>
<p>In SED Stacker, the user selects the combination statistic from the list. The options again are Average, Weighted Avg (Average) [2], and Sum. The user also chooses which units she would like to stack in from the Y Axis and Bin Size Units drop-down lists (default: [erg/s/cm2/Angstrom] vs [Angstrom]).</p>
<p>The Bin Size may be linear or logarithmic. This behavior is controlled with the &#x201c;Logarithmic binning&#x201d; checkbox. By default, the binning is logarithmic, meaning that the input bin size is in log-space as well. For example, a bin size of 1.0 would be a decade, and a bin size of 0.2 is one-fifth of a decade. To turn on <i>linear</i> binning, uncheck the logarithmic binning box. Be sure to select an appropriate bin size and bin unit when using linear binning. We suggest using logarithmic binning when a SED spans 3 decades or more.</p>
<p>The user may optionally smooth out the stacked SED with a boxcar method by checking &#x201c;Smooth&#x201d; and selecting the boxcar width (always linear; same units as the Bin Size Units). The smoothing is done after the SEDs are stacked. To smooth the stacked SED, we use</p>
<p><tt>numpy.convolve(spectral_values, window_array,         window='same')</tt>, where\</p>
<p><tt>window_array = numpy.ones(int(smooth_boxsize) / float(smooth_boxsize))</tt>.</p>
<p>Clicking &#x201c;Stack!&#x201d; combines the SEDs together based on the stacking parameters into a single SED. The stacked SED is added to the SED Builder and SED Viewer. Unlike redshifting and normalizing, SEDs can be stacked any number of times with different sets of stacking parameters without affecting the SEDs.</p>
<p><img src="./imgs/featureless-agn-stacked_small.jpg" alt="screenshot of SED Stacker component" /> <b>Figure 13.</b> The averaged SED of the rest-frame, normalized (by integration) featureless AGN using logarithmic binning with bin sizes of 0.1 decades, combined in mJy vs microns.</p>
<p><b>[2] NOTE:</b> If weighted average is chosen, and there are points without errors associated with it, an average will be taken instead. This is because we don&#x2019;t want the statistics to be muddled; for example, if there are 6 points in a bin, but only 5 have associated uncertainties, combining the errors wouldn&#x2019;t make sense without making some assumptions or removing the points without associated uncertainties. Instead, we suggest that the user remove the points without uncertainties using the Metadata Browser in the SED Viewer first if they want to use weighted average.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h2><a name="Useful_Tips_and_Tricks"></a><a name="useful-tips"></a> Useful Tips and Tricks</h2>
<p>Here is a list of useful tips and tricks to using SED Stacker to its fullest potential.</p>
<div class="section">
<h3><a name="Treating_Segments_as_SEDs_in_SED_Stacker"></a><a name="segments-as-seds"></a> Treating Segments as SEDs in SED Stacker</h3>
<p>When adding SEDs to a Stack, the user has the option to treat the Segments within a SED as individual SEDs by checking the appropriate box of the same name in the Add SEDs frame. This allows the user to stack the SED segments together, rather than flattening the segments to one SED (the default behavior of SED Stacker).</p>
<p>Say the user creates a Stack, and redshifts and normalizes its SEDs. They create a SED of the Stack to visualize in the SED Viewer. After looking at the data, they want to filter out some of the data points from the SEDs with the Metadata Browser, and use the filtered SEDs for their Stack. The user can open the Add SEDs window, highlight their filtered SED-representation of their Stack, and check the &#x201c;Treat Segments as SEDs&#x201d; option. This adds the segments as individual SEDs. The user can then remove the old SEDs in the Stack.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div></div>
<div class="section">
<h2><a name="Other_Uses_of_SED_Stacker"></a><a name="other-uses"></a> Other Uses of SED Stacker</h2>
<div class="section">
<h3><a name="Redshifting_without_correcting_the_flux"></a><a name="redshift-1"></a> Redshifting without correcting the flux</h3>
<p>By default, the Iris redshifter in the Science Tools corrects the flux so that the energy (integral) of the original SED equals that of the shifted SED. If you do not want to make this correction, you may add the SED into a Stack, un-select &#x201c;Correct flux,&#x201d; select &#x201c;Create SED,&#x201d; and click &#x201c;Redshift.&#x201d;</p>
<p><img src="./imgs/useful-tips_redshifting_small.jpg" alt="screenshot of SED Stacker" /></p>
<p><b>Figure 14.</b> Shifting a SED to rest-frame without correcting for the flux.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Normalizing_a_single_SED"></a><a name="normalize-1"></a> Normalizing a single SED</h3>
<p>If you want to normalize a single SED, you can add the SED into a Stack, and normalize by Integration or At Point to a value (you can&#x2019;t normalize a single SED to the average or median of the Stack, since there&#x2019;s only one SED!). Creating a SED after normalizing gives you the normalized SED in the SED Builder for further analysis with other Iris tools.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Normalizing_multiple_SEDs"></a><a name="normalize-2"></a> Normalizing multiple SEDs</h3>
<p>Normalizing multiple SEDs is trickier than normalizing a single SED. If you want to normalize multiple SEDs, you can add the SED into a Stack, and normalize with any normalization parameter set. Select &#x201c;Create SED&#x201d; and normalize. In the SED Viewer, you can open the Metadata Browser and use the Boolean filter to select the points with the same target name (column b:), and Extract the highlighted points to a new SED.</p>
<p><img src="./imgs/normalize-cosmos-agn_useful-tips_small.jpg" alt="screenshot of SED Stacker" /> <img src="./imgs/normalize-cosmos-agn_useful-tips_metadata-browser_small.jpg" alt="screenshot of SED Stacker" /></p>
<p><b>Figure 15.</b> <i>Top</i>: Normalizing the rest-frame COSMOS AGN to the average flux of the SEDs at 2.9 microns. <i>Bottom</i>: Then we can extract the individual SEDs out using the Metadata Broswer.</p>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div></div>
<div class="section">
<h2><a name="Troubleshooting"></a><a name="troubleshooting"></a> Troubleshooting</h2>
<div class="section">
<h3><a name="Redshifting"></a><a name="redshift-troubleshoot"></a> Redshifting</h3>

<ul>
  
<li>
<p>If a SED doesn&#x2019;t have a redshift associated with it, the SED is not redshifted, but is kept in the stack. An info message telling the user which SED was not shifted is shown.</p></li>
  
<li>
<p><i>The redshifts of my SEDs changed since the last time I opened the Add SEDs frame. Why?</i></p>
<p>Changing the redshifts through the Added SEDs table will change the redshift shown in the Add SEDs window. This behavior does NOT change the redshift values in other Stacks that have previously added that SED.</p></li>
</ul>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Normalizing"></a><a name="normalize-troubleshoot"></a> Normalizing</h3>

<ul>
  
<li>
<p><i>The normalization values are changing in an unexpected way. Why?</i></p>
<p>For the time being, SED Stacker does not keep track of the old normalization constants, nor does it track the units in the Added SEDs table. Users will have to write down the normalization constants and associated units if they&#x2019;re interested in them.</p></li>
  
<li>
<p>If you have already normalized a Stack, changing the parameters and normalizing again does NOT undo the previous normalization! Internally, the SEDs added to a stack are changed each time the user clicks &#x201c;Redshift&#x201d; or &#x201c;Normalize.&#x201d; For example, if a user normalizes with one set of parameters, then normalizes again with a new set of parameters, the SEDs are normalized twice. The SEDs are renormalized on top of the first normalization. We implemented SED Stacker this way on purpose, so that users could renormalize their SEDs.</p>
<p>To reset the normalization parameters, click &#x201c;Reset&#x201d; in the bottom-right corner of the window. Note that &#x201c;Reset&#x201d; resets the whole Stack back to its original state, meaning that if any redshifting was done, the SEDs should be re-shifted.</p></li>
  
<li>
<p>If a SED falls outside the min-max range specified in the normalization parameters, that SED is not normalized. A warning is sent to the user saying which SED(s) have not been normalized.</p></li>
</ul>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div>
<div class="section">
<h3><a name="Stacking"></a><a name="stack-troubleshoot"></a> Stacking</h3>

<ul>
  
<li>
<p><i>Too many bins (number of bins: (XXXXXX))</i></p>
<p>In Python, an array is created from the minimum to maximum spectral values in the Stack, with equally-spaced values of the input bin size. This error occurs when the array is over 500,000 bins long. This usually happens when a user tries to stack in linear space when the spectral values are large, and/or spanning many decades.</p>
<p>Here are two ways you can reconciling this error:</p>
  
<ol style="list-style-type: decimal">
    
<li>Switch to logarithmic space. If you have an SED that&#x2019;s spanning a few decades, bin with a logarithmic scale. Remember: when in log scale, the bin size is also in log space (so bin size 0.5 is a half a decade).</li>
    
<li>Switch the bin size units so the spectral values are smaller. Switching from Angstroms to microns, or Hz to GHz, will make a big difference.</li>
  </ol></li>
</ul>

<ul>
  
<li>
<p><i>&#x201c;Weighted Average&#x201d; is giving same results as &#x201c;Average&#x201d;</i></p>
<p>If weighted average is chosen, and there are points without errors associated with it, an average will be taken instead. This is because we don&#x2019;t want the statistics to be muddled; for example, if there are 6 points in a bin, but only 5 have associated uncertainties, combining the errors wouldn&#x2019;t make sense without making some assumptions or removing the points without associated uncertainties. Instead, we suggest that the user remove the points without uncertainties using the Metadata Browser in the SED Viewer first if they want to use weighted average.</p></li>
  
<li>
<p><i>A stacking error has occurred. Please see the Iris documentation.</i></p>
<p>If you see this error, check that:</p>
  
<ul>
    
<li>the smoothing box size is not larger than the number of points than the resultant SED. A way you can check the size of the SED is by creating a SED with the smooth option off. If the number of points in the stacked SED is less than the smooth box size, then this is your error.</li>
  </ul>
<p>Otherwise, please contact us with your problem at the <a href="/helpdesk">CXC HelpDesk</a>.</p></li>
</ul>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<hr /></div></div>
<div class="section">
<h2><a name="History"></a><a name="history"></a> History</h2>

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th>Date </th>
      
<th>Change </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td>07&#xa0;May&#xa0;2015 </td>
      
<td>First issue. Added in Iris 2.1 beta. </td>
    </tr>
  </tbody>
</table>
<hr />

<table border="0" class="table table-striped">
  <thead>
    
<tr class="a">
      
<th align="right"> </th>
    </tr>
  </thead>
  <tbody>
    
<tr class="b">
      
<td align="right">[<a href="#top">Back to top</a>]</td>
    </tr>
  </tbody>
</table>
<!-- external links -->
<!-- threads -->
<!-- extras (Iris models) -->
<!-- reference files -->
<!-- CXC links -->
<!-- Navigation --></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                                      <p >Copyright &copy;                   2015.
          All rights reserved.      
                    
      </p>
                </div>

        
                </div>
    </footer>
        </body>
</html>
